# 具体的なDBテーブル案
本システムにおけるトレーサビリティ設計では、米の流通全体を複数フェーズに分割し、それぞれのフェーズで適切なデータテーブルを設置しています。以下に各テーブルの役割と設計意図を示します。

## 生産フェーズ
生産フェーズでは実際の田んぼに紐ついた生産地とそこから収穫される収穫テーブルに分ける。
収穫は生産地と次の集荷場をつなぐものであり実際の流通を表すものである。

### 生産地テーブル
- 生産地ID
- 生産者
- 品種
- 面積
- 予測収量
- 住所(地域・気候ファクターチェック用)
- 収穫IDのリスト

### 収穫テーブル
- 収穫ロッド(ID)
- 親の生産地ID
- 収穫日
- 品種
- 量

このテーブルには、実生産データに加えて、政府備蓄米の放出やMA米（輸入米）など、みなし生産データも含める。

## 集荷フェーズ
集荷フェーズは前章で述べたように総量把握のために非常に重要なフェーズで集荷場単位で管理する。
後述するように本DBシステムでは一年度ごとに更新することを想定するためにその期間中に全量の整合性をここで合わせる。また、次年度への繰り越しのフィールドを持つ。

### 集荷場テーブル
- 集荷場ID
- 事業者
- 所在地
- 収穫IDのリスト
- 流通ノードIDのリスト
- 備蓄量(上二つのリストからの計算)
- 前年度繰越量
 
ここから先はいろいろ混在する流通フェーズIDで管理され生産フェーズのIDへさかのぼることはできない。

## (玄米/白米)流通フェーズ
このフェーズはコメの流通としては最も広く複雑になることが予測される。
流通を表す流通テーブルと流通で集められた、保管やブレンド含む、流通ノードテーブルに分ける。
流通が“線”でノードが“交点”であるような構成をとる。

### 流通テーブル
- 流通ID
- 流入ノードID
- 流出ノードID
- 品種
- 数量
- 用途(主食用/加工用/飼料用など)

このテーブル設計は玄米/白米で共用する。
別テーブルにするか、フラグで管理するかなどは要議論

### 流通ノードテーブル
このテーブルは後述する精米/消費テーブルの基底テーブルであり同一的に管理される。
そのための主キーとして働くのがノードIDである
- ノードID(主キー)
- 流入するIDのリスト
- 流出するIDのリスト
- 種類(集荷/保管/精米/消費 etc)
- 集荷場ID/保管所ID/精米所ID

流入IDも流出するIDも基本的には白米/玄米は同一の流通IDであるが、以下の場合は別のIDになる。
集荷の場合は流入IDは収穫IDになる。
また、派生テーブルで扱うが精米の場合も流入する流通IDは玄米であるが流出する流通IDは白米の流通テーブルのものになる。

### 保管所テーブル
流通ノードから参照されるだけのテーブル。

- 保管所ID
- (保管された流通ノードIDのリスト)        
- 事業者
- 所在地

## 精米フェーズ
ここでは主に主食用に用いられる総量を把握するために用いる。

### 精米所テーブル
- 精米所ID
- 所在地
- 事業者

その他、付帯情報として精米能力(t/日)などのフィールドは要検討

### 精米テーブル
このテーブルは玄米と白米の流通が交わる特殊な流通ノードとみなせる(サブタイプ)。
玄米流通ID(流入)と精米流通ID(流出)は一対一である。

- ノードID(主キー)
- 流入する流通ID(玄米流通テーブル)
- 流出する流通ID(精米流通テーブル)
- 精米所ID(住所の代わり)
- 処理日
- 精米割合(%)

事業者は精米所から辿れるとして本テーブルに入れない

## 白米流通フェーズ
基本的に玄米と同じ構成

## 消費フェーズ
これは流入する流通IDのみ持って流出する流通IDを持たない特殊な流通ノードの役割(サブタイプ)を持つ。

### 消費テーブル
- ノードID
- 流入する流通ID
- 消費先(家庭/業務/加工用/飼育用/備蓄/輸出/その他)
- 事業者
- 消費地
- 消費完了日

家庭用主食はパッケージングされた時点で消費されたとみなす、つまりパッケージ化した業者が事業者。

